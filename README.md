# Project_Mask

## Описание:

Проект Project_Mask представляет собой серверную часть виджета банковских операций и содержит следующие модули и функции:
1. В модуле main.py реализована функция main, которая отвечает за основную логику проекта и связывает функциональности между собой.\
    Программа приветствует пользователя:\
    Программа: Привет! Добро пожаловать в программу работы с банковскими транзакциями.\
    Выберите необходимый пункт меню:
    1. Получить информацию о транзакциях из JSON-файла
    2. Получить информацию о транзакциях из CSV-файла
    3. Получить информацию о транзакциях из XLSX-файла\
    После пользователь выбирает статус интересующих его операций.\
    Программа: Введите статус, по которому необходимо выполнить фильтрацию.\
    Доступные для фильтровки статусы: EXECUTED, CANCELED, PENDING\
    После фильтрации программа выводит следующие вопросы для уточнения выборки операций, необходимых пользователю, и выводит в консоль операции, соответствующие выборке пользователя:\
    Программа: Отсортировать операции по дате? Да/Нет\
    Пользователь: да\
    Программа: Отсортировать по возрастанию или по убыванию? \
    Пользователь: по возрастанию/по убыванию\
    Программа: Выводить только рублевые транзакции? Да/Нет\
    Пользователь: да\
    Программа: Отфильтровать список транзакций по определенному слову в описании? Да/Нет\
    Пользователь: да/нет\
    Программа: Распечатываю итоговый список транзакций...\
    Программа: Всего банковских операций в выборке: 4
    ```
        08.12.2019 Открытие вклада
        Счет **4321
        Сумма: 40542 RUB

        12.11.2019 Перевод с карты на карту
        MasterCard 7771 27** **** 3727 -> Visa Platinum 1293 38** **** 9203
        Сумма: 130 USD

        18.07.2018 Перевод организации
        Visa Platinum 7492 65** **** 7202 -> Счет **0034
        Сумма: 8390 RUB

        03.06.2018 Перевод со счета на счет
        Счет **2935 -> Счет **4321
        Сумма: 8200 EUR
    ```
    Если выборка оказалась пустой, программа выводит сообщение:\
    Программа: Не найдено ни одной транзакции, подходящей под ваши условия фильтрации

    Кроме того, программа выводит информацию о количестве транзакций по категориям:
    ```
        Количество транзакций по категориям:
        Перевод с карты на карту: 1
        Открытие вклада: 1
        Перевод со счета на счет: 1
        Перевод организации: 1
    ```
2. Модуль masks содержит:
   - Функцию маскировки номера банковской карты get_mask_card_number
   - Функцию маскировки номера банковского счета get_mask_account
2. Модуль widget содержит:
   - Функцию mask_account_card, которая может обрабатывать информацию как о картах, так и о счетах. Эта функция принимает строку, содержащую тип и номер карты или счета, и возвращает строку с замаскированным номером.
   - Функцию форматирования даты get_date
3. Модуль processing содержит:
   - Функцию фильтрации списка операций по параметру состояния filter_by_state
   - Функцию сортировки операций по дате sort_by_date
4. Модуль generators, содержащий функции для работы с массивами транзакций:
   - Функция filter_by_currency, принимающая на вход список словарей, представляющих транзакции. Функция возвращает итератор, который поочередно выдает транзакции, где валюта операции соответствует заданной (USD либо RUB).
       
    *Пример использования функции filter_by_currency:*

          transactions - список словарей, содержащий набор данных о каждой транзакции.
          currency - код валюты, по которой требуется отфильтровать список транзакций (например, "USD").

          ```
             usd_transactions = filter_by_currency(transactions, currency="USD") # Создаем переменную, в которую будет передаватья результат работы функции при каждой итерации
             for _ in range(2): # Задаем количество итераций
                 print(next(usd_transactions)) # Выводим результат каждой итерации поочередно

          >>>       {
                       "id": 939719570,
                       "state": "EXECUTED",
                       "date": "2018-06-30T02:08:58.425572",
                       "operationAmount": {
                           "amount": "9824.07",
                           "currency": {
                               "name": "USD",
                               "code": "USD"
                           }
                       },
                       "description": "Перевод организации",
                       "from": "Счет 75106830613657916952",
                       "to": "Счет 11776614605963066702"
                     },
                     {
                       "id": 142264268,
                       "state": "EXECUTED",
                       "date": "2019-04-04T23:20:05.206878",
                       "operationAmount": {
                           "amount": "79114.93",
                           "currency": {
                                "name": "USD",
                                "code": "USD"
                           }
                       },
                    "description": "Перевод со счета на счет",
                    "from": "Счет 19708645243227258542",
                    "to": "Счет 75651667383060284188"
                    }
          ```
    - Функция transaction_descriptions - генератор, который принимает список словарей с транзакциями и возвращает описание каждой операции по очереди.
   
    *Пример использования функции transaction_descriptions:*

          ```
              transactions - список словарей, содержащий набор данных о каждой транзакции.
              descriptions = transaction_descriptions(transactions) # Создаем переменную, в которую будет передаватья результат работы функции при каждой итерации
              for _ in range(5): # Задаем количество итераций
                  print(next(descriptions)) # Выводим результат каждой итерации поочередно
          >>> Перевод организации
              Перевод со счета на счет
              Перевод со счета на счет
              Перевод с карты на карту
              Перевод организации
          ```
    - Функция card_number_generator - генератор, который выдает номера банковских карт в формате XXXX XXXX XXXX XXXX , где X — цифра номера карты. Генератор может сгенерировать номера карт в заданном диапазоне от 0000 0000 0000 0001 до 9999 9999 9999 9999.
      Генератор должен принимать начальное и конечное значения для генерации диапазона номеров.
   
    *Пример использования функции card_number_generator:*

          ```
             for card_number in card_number_generator(1, 5): # Задаем начальное и конечное значения для генерации диапазона номеров  
             print(card_number) # Поочередно выводим результат каждой итерации согласно заданному диапазону

          >>> 0000 0000 0000 0001
              0000 0000 0000 0002
              0000 0000 0000 0003
              0000 0000 0000 0004
              0000 0000 0000 0005
          ```
5. Модуль decorators, содержащий декоратор log. Декоратор log автоматически логирует начало и конец выполнения функции, а также ее результаты или возникшие ошибки.\
   Декоратор принимает необязательный аргумент filename, который определяет, куда будут записываться логи (в файл или в консоль):
   
       - если filename задан, логи записываются в указанный файл.
       - если filename не задан, логи выводятся в консоль.
   
Логирование включает:

       - имя функции и результат выполнения при успешной операции.
       - имя функции, тип возникшей ошибки и входные параметры, если выполнение функции привело к ошибке.
                 
   *Пример использования декоратора log:*
      
          ```
          @log(filename="mylog.txt")
             def apply_get_mask_card_number(card_number: str) -> str:
                 return get_mask_card_number(card_number)
             result = apply_get_mask_card_number("7000792289606361")
             
          Ожидаемый вывод в лог-файл mylog.txt при успешном выполнении:
          >>>apply_get_mask_card_number ok. Result: 7000 79** **** 6361
             
          Ожидаемый вывод при ошибке:
          >>>apply_get_mask_card_number error: ValueError. Inputs: ('70007922896063&1',), {}
         ```
6. Модуль utils, содержащий функцию get_transactions_from_json. Данная функция принимает на вход путь до JSON-файла и возвращает список словарей с данными
    о финансовых транзакциях. Если файл пустой, содержит не список или не найден, функция возвращает пустой список. Для целей проекта функция обрабатывает файл operations.json, расположенный в папке data в корне проекта.
    Пример использования функции:
    ```
    if __name__ == "__main__":
        PATH_TO_JASON_FILE = os.path.join(os.path.dirname(__file__), "data", "operations.json")  # Формируем путь к файлу operations.json
        print(get_transactions_from_json(PATH_TO_JASON_FILE)) # Выводим результат на экран
   ```
7. Модуль external_api, содержащий функцию get_amount_in_rubles. Функция принимает на вход транзакцию и возвращает сумму транзакции в рублях (тип данных: float).
    Если транзакция была в USD или EUR, происходит обращение к внешнему API (Exchange Rates Data API) для получения текущего курса валют и конвертации суммы в рубли.
    Пример использования функции:
    ```
    transaction = {
        "id": 939719570,
        "state": "EXECUTED",
        "date": "2018-06-30T02:08:58.425572",
        "operationAmount": {"amount": "9824.07", "currency": {"name": "EUR", "code": "EUR"}},
        "description": "Перевод организации",
        "from_": "Счет 75106830613657916952",
        "to": "Счет 11776614605963066702",
    }
   
   if __name__ == "__main__":
        print(get_amount_in_rubles(transaction))  # конвертируем сумму из евро в рубли
   ```
8. Для модулей masks.py и utils.py созданы объекты логирования с использованием библиотеки logging.
9. Реализована поддержка форматов данных csv и excel. Для этого создан модуль operations, содержащий функции get_operations_from_csv и get_operations_from_excel соответственно. Данные функции принимают на вход путь до CSV-файла или XLSX-файла и возвращают список словарей с данными
    о финансовых транзакциях. Если файл пустой, содержит не список или не найден, функция возвращает пустой список. В папке data в корне проекта расположены соответствующие файлы (transactions.csv и transactions_excel.xlsx).
    Пример использования функций:
    ```
    if __name__ == "__main__":
        PATH_TO_CSV_FILE = os.path.join(os.path.dirname(__file__), "data", "transactions.csv") # Формируем путь к CSV-файлу transactions.csv
        print(get_operations_from_csv(PATH_TO_CSV_FILE)) # Выводим результат чтения CSV-файла на экран
   
        PATH_TO_EXCEL_FILE = os.path.join(os.path.dirname(__file__), "data", "transactions_excel.xlsx") # Формируем путь к XLSX-файлу transactions_excel.xlsx
        print(get_operations_from_excel(PATH_TO_EXCEL_FILE)) # Выводим результат чтения XLSX-файла на экран
   ```
10. Модуль search, содержащий функцию search_transactions. Функция принимает список словарей с данными о банковских операциях и строку поиска, а возвращает список словарей, у которых в описании есть данная строка.
11. Модуль categories, содержащий функцию count_categories. Функция принимает список словарей с данными о банковских операциях и список категорий операций, а возвращает словарь, в котором ключи — это названия категорий, а значения — это количество операций в каждой категории. Категории операций хранятся в поле description
12. Модуль formatting, содержащий фунцию format_transaction. Функция принимает на вход одну транзакцию и приводит ее к требуемому формату вывода. 
    Например:\
    Ваши исходные данные:
    ```
           data = [
           {'id': 3235160.0, 'state': 'EXECUTED', 'date': '2023-11-12T16:17:52Z', 'amount': 34316.0, 'currency_name': 'Euro', 'currency_code': 'EUR', 'from': 'Visa 2336865385909932', 'to': 'American Express 2266395591845773', 'description': 'Перевод с карты на карту'}, 
           {'id': 3055091.0, 'state': 'EXECUTED', 'date': '2023-11-10T23:50:55Z', 'amount': 23211.0, 'currency_name': 'Zloty', 'currency_code': 'PLN', 'from': 'Счет 15909625020513310297', 'to': 'Счет 90621941572206379881', 'description': 'Перевод со счета на счет'}
           ]
    ```
    Результат выполнения функции:
    ```
    12.11.2023 Перевод с карты на карту
    Visa 2336 86** **** 9932 -> American Express 2266395591845773
    Сумма: 34316.0 EUR

    10.11.2023 Перевод со счета на счет
    Счет **0297 -> Счет **9881
    Сумма: 23211.0 PLN
    ```
    В этом же модуле также реализована функция print_formatted_transactions, которая выводит на экран итоговый отформатированный список транзакций.
## Установка:

1. Клонируйте репозиторий:
```
git clone https://github.com/AlexanderKokorinV/Project_Mask.git
```
2. Установите зависимости:
```
pip install -r requirements.txt
```

## Тестирование
Проект использует `pytest` для написания и выполнения тестов. Чтобы запустить тесты, следуйте инструкциям ниже:
1. Убедитесь, что `pytest` установлен. Если нет, установите его командой:
```
pip install pytest
```
2. В корневой директории проекта выполните команду для запуска всех тестов:
```
pytest
```
3. Если необходимо, вы можете указать конкретный файл теста:
```
pytest tests/test_generators.py
```
Это позволит убедиться, что проект работает корректно и все функции проходят проверку.

## Лицензия:

Этот проект лицензирован по [лицензии MIT](LICENSE).
